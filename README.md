**ЁЯза Ansible ржХрзА?**
Ansible рж╣рж▓рзЛ ржПржХржЯрж┐ ржУржкрзЗржи рж╕рзЛрж░рзНрж╕ automation tool ржпрзЗржЯрж╛ ржжрж┐рзЯрзЗ ржЖржкржирж┐ рж╕рж╣ржЬрзЗржЗ configuration management, application deployment, task automation, network automation ржПржмржВ multi-node orchestration ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

**Ansible ржХрзЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи?**

* **рж╕рж░рж▓рждрж╛:** ржПржЯрж┐ YAML ржлрж╛ржЗрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржХрж╛ржЬ ржХрж░рзЗ, ржпрж╛ ржкрзЬрж╛ ржПржмржВ рж▓рзЗржЦрж╛ ржЦрзБржм рж╕рж╣ржЬред ржЬржЯрж┐рж▓ рж╕рзНржХрзНрж░рж┐ржкрзНржЯрж┐ржВ ржПрж░ ржкрзНрж░рзЯрзЛржЬржи рж╣рзЯ ржирж╛ред
* **Agentless:** ржЯрж╛рж░рзНржЧрзЗржЯ ржорзЗрж╢рж┐ржирзЗ ржХрзЛржирзЛ ржПржЬрзЗржирзНржЯ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛рж░ ржЭрж╛ржорзЗрж▓рж╛ ржирзЗржЗред рж╢рзБржзрзБ SSH ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржерж╛ржХрж▓рзЗржЗ рж╣рзЯред
* **ржХрзНрж╖ржорждрж╛рж╢рж╛рж▓рзА:** ржПржЯрж┐ ржжрж┐рзЯрзЗ ржЫрзЛржЯ ржЯрж╛рж╕рзНржХ ржерзЗржХрзЗ рж╢рзБрж░рзБ ржХрж░рзЗ ржЬржЯрж┐рж▓ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржбрзЗржкрзНрж▓рзЯржорзЗржирзНржЯ ржПржмржВ ржкрзБрж░рзЛ рж╕рж┐рж╕рзНржЯрзЗржо ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржЕржЯрзЛржорзЗржЯ ржХрж░рж╛ ржпрж╛рзЯред
* **ржоржбрзБрж▓рж╛рж░:** ржПрждрзЗ ржкрзНрж░ржЪрзБрж░ ржмрж┐рж▓рзНржЯ-ржЗржи ржоржбрж┐ржЙрж▓ ржЖржЫрзЗ ржмрж┐ржнрж┐ржирзНржи ржЯрж╛рж╕рзНржХ рж╕ржорзНржкржирзНржи ржХрж░рж╛рж░ ржЬржирзНржп (ржпрзЗржоржи: ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛, ржлрж╛ржЗрж▓ ржХржкрж┐ ржХрж░рж╛, рж╕рж╛рж░рзНржнрж┐рж╕ рж╕рзНржЯрж╛рж░рзНржЯ/рж╕рзНржЯржк ржХрж░рж╛ ржЗрждрзНржпрж╛ржжрж┐)ред
* **рж╕ржорзНржкрзНрж░ржжрж╛рзЯ (Community):** ржПрж░ ржПржХржЯрж┐ ржмрзЬ ржПржмржВ рж╕ржХрзНрж░рж┐рзЯ ржХржорж┐ржЙржирж┐ржЯрж┐ рж░рзЯрзЗржЫрзЗ, рждрж╛ржЗ рж╕рж╛рж╣рж╛ржпрзНржп рж╕рж╣ржЬрзЗржЗ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯред

**Ansible ржПрж░ ржорзВрж▓ ржзрж╛рж░ржгрж╛ (Core Concepts)**

Ansible ржПрж░ ржХрж┐ржЫрзБ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржзрж╛рж░ржгрж╛ ржмрзЛржЭрж╛ ржЬрж░рзБрж░рж┐:

1.  **Control Node:** ржПржЯрж┐ рж╕рзЗржЗ рж╕рж╛рж░рзНржнрж╛рж░ ржпрзЗржЦрж╛ржирзЗ Ansible ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржерж╛ржХрзЗ ржПржмржВ ржпрзЗржЦрж╛ржи ржерзЗржХрзЗ ржХржорж╛ржирзНржб ржмрж╛ ржкрзНрж▓рзЗржмрзБржХ ржЪрж╛рж▓рж╛ржирзЛ рж╣рзЯред
2.  **Managed Nodes:** ржПржЧрзБрж▓рзЛ рж╣рж▓рзЛ рж╕рзЗржЗ рж╕рж╛рж░рзНржнрж╛рж░ ржмрж╛ ржбрж┐ржнрж╛ржЗрж╕ржЧрзБрж▓рзЛ ржпрж╛ Ansible ржжрзНржмрж╛рж░рж╛ ржорзНржпрж╛ржирзЗржЬ ржХрж░рж╛ рж╣рзЯред ржПржжрзЗрж░ржХрзЗ "рж╣рзЛрж╕рзНржЯ" ржмрж╛ "ржЯрж╛рж░рзНржЧрзЗржЯ ржорзЗрж╢рж┐ржи"ржУ ржмрж▓рж╛ рж╣рзЯред
3.  **Inventory:** ржПржЯрж┐ ржПржХржЯрж┐ ржлрж╛ржЗрж▓ ржпрзЗржЦрж╛ржирзЗ Managed Nodes ржПрж░ рж▓рж┐рж╕рзНржЯ ржПржмржВ рждрж╛ржжрзЗрж░ ржЧрзНрж░рзБржк рж╕ржорзНржкрж░рзНржХрзЗ рждржерзНржп ржерж╛ржХрзЗред Ansible ржЬрж╛ржирждрзЗ ржкрж╛рж░рзЗ ржХрзЛржи ржорзЗрж╢рж┐ржирзЗ ржХрзА ржХрж╛ржЬ ржХрж░рждрзЗ рж╣ржмрзЗ Inventory ржлрж╛ржЗрж▓рзЗрж░ ржорж╛ржзрзНржпржорзЗред ржПржЯрж┐ INI ржмрж╛ YAML ржлрж░ржорзНржпрж╛ржЯрзЗ рж╣рждрзЗ ржкрж╛рж░рзЗред
    * ржЙржжрж╛рж╣рж░ржг Inventory (`hosts` ржлрж╛ржЗрж▓):
        ```ini
        [webservers]
        web1.example.com
        web2.example.com

        [dbservers]
        db1.example.com

        [all:vars]
        ansible_python_interpreter=/usr/bin/python3
        ```
4.  **Modules:** ржПржЧрзБрж▓рзЛ Ansible ржПрж░ ржХрж╛рж░рзНржпржХрж╛рж░рж┐рждрж╛рж░ ржХрзНрж╖рзБржжрзНрж░рждржо ржЗржЙржирж┐ржЯред ржкрзНрж░рждрж┐ржЯрж┐ ржоржбрж┐ржЙрж▓ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж╛ржЬ ржХрж░рзЗ (ржпрзЗржоржи: `apt` ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛рж░ ржЬржирзНржп, `copy` ржлрж╛ржЗрж▓ ржХржкрж┐ ржХрж░рж╛рж░ ржЬржирзНржп, `file` ржлрж╛ржЗрж▓ ржмрж╛ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ рждрзИрж░рж┐/ржорзБржЫрзЗ ржлрзЗрж▓рж╛рж░ ржЬржирзНржп)ред Ansible Playbook ржмрж╛ Ad-hoc ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛ржирзЛрж░ рж╕ржорзЯ ржоржбрж┐ржЙрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯред ржоржбрж┐ржЙрж▓ржЧрзБрж▓рзЛ Idempotent рж╣рзЯ, ржЕрж░рзНржерж╛рзО ржПржХржЗ ржоржбрж┐ржЙрж▓ ржмрж╛рж░ржмрж╛рж░ ржЪрж╛рж▓рж╛рж▓рзЗржУ рж╢рзЗрж╖ ржкрж░рзНржпржирзНржд рж╕рж╛рж░рзНржнрж╛рж░ ржПржХржЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЕржмрж╕рзНржерж╛рзЯ ржкрзМржБржЫрж╛ржмрзЗред
5.  **Tasks:** ржПржХржЯрж┐ ржЯрж╛рж╕рзНржХ рж╣рж▓рзЛ ржПржХржЯрж┐ ржоржбрж┐ржЙрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржХрзЛржирзЛ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж╛ржЬ ржХрж░рж╛ред Playbook ржП ржЯрж╛рж╕рзНржХржЧрзБрж▓рзЛ рж▓рж┐рж╕рзНржЯ ржЖржХрж╛рж░рзЗ рж▓рзЗржЦрж╛ ржерж╛ржХрзЗред
    * ржЙржжрж╛рж╣рж░ржг Task:
        ```yaml
        - name: Ensure apache is installed
          apt:
            name: apache2
            state: present
        ```
6.  **Playbooks:** ржПржЧрзБрж▓рзЛ YAML ржлрж╛ржЗрж▓ ржпрж╛ ржЯрж╛рж╕рзНржХрзЗрж░ ржПржХржЯрж┐ рждрж╛рж▓рж┐ржХрж╛ ржзрж╛рж░ржг ржХрж░рзЗред ржПржХржЯрж┐ ржкрзНрж▓рзЗржмрзБржХ ржжрзНржмрж╛рж░рж╛ ржЖржкржирж┐ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЕржмрж╕рзНржерж╛ ржмрж░рзНржгржирж╛ ржХрж░рзЗржиред Playbooks рж╣рж▓рзЛ Ansible ржПрж░ ржорзВрж▓ рж╢ржХрзНрждрж┐, ржХрж╛рж░ржг ржПржЧрзБрж▓рж┐ ржПржХрж╛ржзрж┐ржХ ржЯрж╛рж╕рзНржХржХрзЗ ржПржХрждрзНрж░рзЗ рж▓ржЬрж┐ржХрзНржпрж╛рж▓ ржЕрж░рзНржбрж╛рж░рзЗ ржПржХрзНрж╕рж┐ржХрж┐ржЙржЯ ржХрж░рждрзЗ ржжрзЗрзЯред
    * ржЙржжрж╛рж╣рж░ржг Playbook (`setup_webserver.yml`):
        ```yaml
        ---
        - name: Setup Web Server
          hosts: webservers
          become: yes # root ржкрзНрж░рж┐ржнрж┐рж▓рзЗржЬ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржЬржирзНржп

          tasks:
            - name: Update apt cache
              apt:
                update_cache: yes

            - name: Install Apache web server
              apt:
                name: apache2
                state: present

            - name: Copy index.html
              copy:
                src: files/index.html # ржХржирзНржЯрзНрж░рзЛрж▓ ржирзЛржбрзЗрж░ ржлрж╛ржЗрж▓
                dest: /var/www/html/index.html # ржЯрж╛рж░рзНржЧрзЗржЯ ржорзЗрж╢рж┐ржирзЗрж░ ржкрж╛рже

            - name: Ensure Apache service is running
              service:
                name: apache2
                state: started
                enabled: yes
        ```
7.  **Roles:** ржЬржЯрж┐рж▓ ржкрзНрж▓рзЗржмрзБржХржЧрзБрж▓рзЛржХрзЗ рж╕ржВржЧржарж┐ржд ржХрж░рж╛рж░ ржЬржирзНржп Role ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯред ржПржХржЯрж┐ Role ржП Tasks, Handlers, Variables, Files, Templates ржЗрждрзНржпрж╛ржжрж┐ ржЖрж▓рж╛ржжрж╛ ржЖрж▓рж╛ржжрж╛ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рждрзЗ рж░рж╛ржЦрж╛ рж╣рзЯред ржПржЯрж┐ ржкрзНрж▓рзЗржмрзБржХржЧрзБрж▓рзЛржХрзЗ ржЖрж░ржУ ржоржбрзБрж▓рж╛рж░, ржкрзБржиржГржмрзНржпржмрж╣рж╛рж░ржпрзЛржЧрзНржп ржПржмржВ рж╕рж╣ржЬрзЗ ржмрзЛржЭрж╛ ржпрж╛рзЯред

**Ansible ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ?**

Ansible ржорзВрж▓ржд SSH ржПрж░ ржорж╛ржзрзНржпржорзЗ Managed Nodes ржПрж░ рж╕рж╛ржерзЗ ржХрж╛ржирзЗржХрзНржЯ рж╣рзЯред ржпржЦржи ржЖржкржирж┐ ржПржХржЯрж┐ Ad-hoc ржХржорж╛ржирзНржб ржмрж╛ Playbook ржЪрж╛рж▓рж╛ржи:

1.  Ansible Control Node ржерзЗржХрзЗ Inventory ржлрж╛ржЗрж▓ ржкрзЬрзЗ ржЯрж╛рж░рзНржЧрзЗржЯ рж╣рзЛрж╕рзНржЯржЧрзБрж▓рзЛ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рзЗред
2.  SSH ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЯрж╛рж░рзНржЧрзЗржЯ рж╣рзЛрж╕рзНржЯрзЗ ржХрж╛ржирзЗржХрзНржЯ рж╣рзЯ (SSH Keys ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╕рзЗрж░рж╛ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕)ред
3.  ржкрзНрж░рзЯрзЛржЬржирзАрзЯ ржоржбрж┐ржЙрж▓ ржмрж╛ ржЯрж╛рж╕рзНржХ ржЯрж╛рж░рзНржЧрзЗржЯ рж╣рзЛрж╕рзНржЯрзЗ ржкрзБрж╢ ржХрж░рзЗред
4.  ржЯрж╛рж░рзНржЧрзЗржЯ рж╣рзЛрж╕рзНржЯрзЗ ржоржбрж┐ржЙрж▓ржЧрзБрж▓рзЛ ржПржХрзНрж╕рж┐ржХрж┐ржЙржЯ ржХрж░рзЗред
5.  ржХрж╛ржЬрзЗрж░ ржлрж▓рж╛ржлрж▓ ржХржирзНржЯрзНрж░рзЛрж▓ ржирзЛржбрзЗ ржлрзЗрж░ржд ржкрж╛ржарж╛рзЯред
6.  ржХрж╛ржЬ рж╢рзЗрж╖рзЗ ржкрзБрж╢ ржХрж░рж╛ ржоржбрж┐ржЙрж▓ржЧрзБрж▓рзЛ ржЯрж╛рж░рзНржЧрзЗржЯ рж╣рзЛрж╕рзНржЯ ржерзЗржХрзЗ рж╕рж░рж┐рзЯрзЗ ржжрзЗрзЯ (ржмрзЗрж╢рж┐рж░ржнрж╛ржЧ ржХрзНрж╖рзЗрждрзНрж░рзЗ)ред

**Ansible ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛**

Ansible ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржмрзЗрж╢ рж╕рж╣ржЬред Control Node ржП Python ржЗржирж╕рзНржЯрж▓ ржерж╛ржХрждрзЗ рж╣ржмрзЗред

* **Debian/Ubuntu-based Linux:**
    ```bash
    sudo apt update
    sudo apt install ansible
    ```
* **RHEL/CentOS/Fedora-based Linux:**
    ```bash
    sudo yum install epel-release # CentOS 7 ржПрж░ ржЬржирзНржп
    sudo yum install ansible     # CentOS/RHEL 7
    # ржЕржержмрж╛ Fedora/CentOS 8+/RHEL 8+ ржПрж░ ржЬржирзНржп
    sudo dnf install ansible
    ```
* **macOS:**
    ```bash
    brew install ansible
    ```

ржЗржирж╕рзНржЯрж▓ рж╣рзЯрзЗ ржЧрзЗрж▓рзЗ, ржнрж╛рж░рзНрж╕ржи ржЪрзЗржХ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:
```bash
ansible --version
```
---

## ЁЯЫая╕П **Ansible Installation (Ubuntu/Debian)**
ржЖржкржирж╛рж░ рж╕рж┐рж╕рзНржЯрзЗржорзЗ Python3 ржерж╛ржХрждрзЗ рж╣ржмрзЗред рж╕рж╛ржзрж╛рж░ржи Ubuntu system-ржП ржирж┐ржЪрзЗрж░ ржоржд ржХрж░рзЗ ржЗржирж╕рзНржЯрж▓ ржХрж░ржмрзЗржи:

```bash
sudo apt update
sudo apt install software-properties-common -y
sudo add-apt-repository --yes --update ppa:ansible/ansible
sudo apt install ansible -y
```

тЬЕ ржЗржирж╕рзНржЯрж▓ рж╣рзЯрзЗ ржЧрзЗрж▓рзЗ, ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржб ржжрж┐рзЯрзЗ ржЪрзЗржХ ржХрж░рзБржи:
```bash
ansible --version
```

ЁЯУМ ржпржжрж┐ ржЖржкржирж┐ Windows ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржи, WSL ржПрж░ ржнрзЗрждрж░рзЗ Ubuntu ржЪрж╛рж▓рж┐рзЯрзЗ ржПржЗ ржПржХржЗ ржзрж╛ржкрзЗ ржЗржирж╕рзНржЯрж▓ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред

---

## ЁЯЧВя╕П **Inventory ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рж╛ (static inventory)**

ржПржХржЯрж┐ ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзБржи `inventory` ржирж╛ржорзЗ:

```ini
[web]
192.168.56.101 ansible_user=ubuntu ansible_ssh_private_key_file=~/.ssh/id_rsa
```

- ржПржЦрж╛ржирзЗ `192.168.56.101` рж╣рж▓рзЛ remote server ржПрж░ IP
- `ansible_user` рж╣рж▓рзЛ SSH username (ржпрзЗржоржи `ubuntu`)
- `ansible_ssh_private_key_file` рж╣рж▓рзЛ private key path

---

## ЁЯФР **Passwordless SSH Setup (local ржерзЗржХрзЗ server-ржП)**

### Step 1: SSH Keygen ржЪрж╛рж▓рж╛ржи:
```bash
ssh-keygen
```

Enter ржЪрзЗржкрзЗ ржЪрзЗржкрзЗ default рж╕рзЗржЯрж┐ржВ рж░рж╛ржЦрзБржиред

### Step 2: Public key remote server-ржП copy ржХрж░рзБржи:
```bash
ssh-copy-id ubuntu@192.168.56.101
```

ржПржЦржи ржЖржкржирж┐ `ssh ubuntu@192.168.56.101` ржжрж┐рзЯрзЗ password ржЫрж╛ржбрж╝рж╛ржЗ ржврзБржХрждрзЗ ржкрж╛рж░ржмрзЗржиред

---

## тЬЕ **Connectivity ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи**

```bash
ansible -i inventory web -m ping
```

Output ржжрзЗржЦрждрзЗ ржПрж░ржХржо рж╣ржмрзЗ:
```json
192.168.56.101 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
```


---
## ЁЯза **Ad-hoc Command ржХрзА?**

Ansible Playbook ржирж╛ рж▓рж┐ржЦрзЗржЗ, ржПржХржмрж╛рж░рзЗрж░ ржЬржирзНржп рж╕рж░рж╛рж╕рж░рж┐ command line ржерзЗржХрзЗ command run ржХрж░рж╛ржХрзЗ ржмрж▓рж╛ рж╣рзЯ **Ad-hoc Command**ред

ЁЯСЙ Syntax:
```bash
ansible <group/host> -i inventory -m <module_name> -a "<arguments>" [--become]
```

---

## ЁЯФз **1. ping module (check connection)**

```bash
ansible web -i inventory -m ping
```

---

## ЁЯФз **2. command module (default module)**

```bash
ansible web -i inventory -a "uptime"
```

ржЕржержмрж╛ рж╕рзНржкрж╖рзНржЯ ржХрж░рзЗ:
```bash
ansible web -i inventory -m command -a "uptime"
```

тЬЕ ржПржЯрж┐ remote server-ржП command run ржХрж░рзЗред

---

## тЪая╕П **3. shell module (command + shell features)**

```bash
ansible web -i inventory -m shell -a "echo $HOME"
```

> shell module ржжрж┐рзЯрзЗ ржЖржкржирж┐ shell feature (like variables, pipes) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред

---

## ЁЯУж **4. apt module (Ubuntu/Debian package manager)**

```bash
ansible web -i inventory -m apt -a "name=nginx state=present update_cache=yes" --become
```

> `--become` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗ root access ржПрж░ ржЬржирзНржпред

---

## ЁЯУЛ **5. service module**

```bash
ansible web -i inventory -m service -a "name=nginx state=started" --become
```

---

## ЁЯУБ **6. copy module (local тЖТ remote file copy)**

```bash
ansible web -i inventory -m copy -a "src=./index.html dest=/var/www/html/index.html" --become
```

---

## ЁЯУВ **7. file module (permission, ownership, directory create)**

```bash
ansible web -i inventory -m file -a "path=/opt/testdir state=directory mode=0755 owner=ubuntu group=ubuntu" --become
```

---

## ЁЯСд **8. user module (ржирждрзБржи user рждрзИрж░рж┐)**

```bash
ansible web -i inventory -m user -a "name=demo state=present" --become
```

---

## ЁЯЫая╕П **9. Gathering System Info (setup module)**

```bash
ansible web -i inventory -m setup
```

> ржПржЯрж╛ ржкрзБрж░рзЛ system information ржЖржиржмрзЗ: IP, hostname, memory, OS, etc.

---

## ЁЯОУ **Bonus: Become root (sudo)**

ржпрзЗрж╕ржм module ржХрж╛ржЬ ржХрж░рждрзЗ root access рж▓рж╛ржЧрзЗ, рж╕рзЗржЧрзБрж▓рзЛрждрзЗ `--become` ржжрж┐рждрзЗ рж╣рзЯред

```bash
ansible web -i inventory -m apt -a "name=htop state=present" --become
```

---

## ЁЯза **Playbook ржХрзА?**

Ansible Playbook рж╣рж▓рзЛ YAML ржлрж░ржорзНржпрж╛ржЯрзЗ рж▓рзЗржЦрж╛ ржлрж╛ржЗрж▓ ржпрзЗржЦрж╛ржирзЗ ржПржХрж╛ржзрж┐ржХ task define ржХрж░рж╛ рж╣рзЯ, sequentially run ржХрж░рж╛рж░ ржЬржирзНржпред

ЁЯСЙ ржПржЯрж╛ shell script ржПрж░ automated version ржпрж╛:
- Repeatable
- Human readable
- Git-ржП рж░рж╛ржЦрж╛ ржпрж╛рзЯ
- Documentation ржПрж░ ржорждрзЛржЗ ржХрж╛ржЬ ржХрж░рзЗ

---

## ЁЯЫая╕П **Playbook Structure:**

```yaml
---
- name: Install and Start Nginx
  hosts: web
  become: yes
  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present
        update_cache: yes

    - name: Start Nginx
      service:
        name: nginx
        state: started
        enabled: true
```

---

## ЁЯУВ **Step-by-Step Breakdown:**

| рж▓рж╛ржЗржи | ржмрзНржпрж╛ржЦрзНржпрж╛ |
|------|----------|
| `---` | YAML ржлрж╛ржЗрж▓ рж╢рзБрж░рзБ |
| `- name:` | ржПржЗ Playbook ржмрж╛ Play ржПрж░ ржирж╛ржо |
| `hosts:` | ржХрзЛржи host/inventory group ржП ржХрж╛ржЬ рж╣ржмрзЗ |
| `become: yes` | root access рж▓рж╛ржЧржмрзЗ |
| `tasks:` | ржПржЦрж╛ржирзЗ рж╢рзБрж░рзБ рж╣рзЯ actual ржХрж╛ржЬ |
| `- name:` | ржкрзНрж░рждрж┐ржЯрж╛ task ржПрж░ readable ржирж╛ржо |
| `apt`, `service` | module ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржХрж╛ржЬ ржХрж░рж╛ рж╣рзЯ |

---

## ЁЯзк **ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржжрзЗржЦрж╛ (ржкрзНрж░ржержо Playbook):**

### ЁЯУЭ `nginx_setup.yml` ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзБржи:

```yaml
---
- name: Install and Configure Nginx
  hosts: web
  become: yes
  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes

    - name: Install nginx
      apt:
        name: nginx
        state: present

    - name: Ensure nginx is running
      service:
        name: nginx
        state: started
        enabled: true
```

---

### тЦ╢я╕П Run ржХрж░рзБржи:

```bash
ansible-playbook -i inventory nginx_setup.yml
```

тЬЕ ржЖржкржирж┐ ржжрзЗржЦржмрзЗржи ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ рж╕ржмржХрж┐ржЫрзБ рж╣ржЪрзНржЫрзЗ: apt update тЖТ nginx install тЖТ nginx start

---

## ЁЯФе **ржЖрж░рзЗржХржЯрж╛ Real-Life Example: Static Website Deploy**

### ЁЯУЭ `deploy_website.yml`:

```yaml
---
- name: Deploy Static Website
  hosts: web
  become: yes
  tasks:
    - name: Copy HTML file
      copy:
        src: ./index.html
        dest: /var/www/html/index.html
        owner: www-data
        group: www-data
        mode: '0644'

    - name: Restart nginx
      service:
        name: nginx
        state: restarted
```

---
## ЁЯза **Ansible Variable ржХрзА?**

Variable рж╣рж▓рзЛ ржХрзЛржирзЛ reusable value, ржпрзЗржоржи: `server_port`, `user_name`, `package_name` ржЗрждрзНржпрж╛ржжрж┐ред  
Playbook ржмрж╛ inventory ржХрзЗ flexible ржХрж░рж╛рж░ ржЬржирзНржп ржПржЧрзБрж▓рзЛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯред

---

## тЬЕ **Variable Declare ржХрж░рж╛рж░ рзлржЯрж┐ ржЬрж╛рзЯржЧрж╛:**

| ржЬрж╛рзЯржЧрж╛                        | Priority |
|-----------------------------|----------|
| Playbook file (inline)      | Medium   |
| Inventory file (host/group) | Medium   |
| `host_vars/` & `group_vars/` | High     |
| Extra vars (`--extra-vars`) | Highest  |
| Role variables               | Medium   |

---

## ЁЯЫая╕П **1. Playbook-ржП Variable define ржУ ржмрзНржпржмрж╣рж╛рж░:**

```yaml
---
- name: Install a package using variable
  hosts: web
  become: yes
  vars:
    pkg_name: nginx
  tasks:
    - name: Install {{ pkg_name }}
      apt:
        name: "{{ pkg_name }}"
        state: present
```

---

## ЁЯЧВя╕П **2. Inventory ржлрж╛ржЗрж▓-ржП Variable ржмрзНржпржмрж╣рж╛рж░:**

```ini
[web]
192.168.56.101 ansible_user=ubuntu http_port=8080
```

Playbook-ржП ржмрзНржпржмрж╣рж╛рж░:
```yaml
- name: Show port number
  hosts: web
  tasks:
    - debug:
        msg: "HTTP Port is {{ http_port }}"
```

---

## ЁЯЧГя╕П **3. group_vars/host_vars ржлрзЛрж▓рзНржбрж╛рж░:**

### Structure:
```
inventory/
тФЬтФАтФА hosts
тФЬтФАтФА group_vars/
тФВ   тФФтФАтФА web.yml
тФФтФАтФА host_vars/
    тФФтФАтФА 192.168.56.101.yml
```

ЁЯУБ `group_vars/web.yml`:
```yaml
http_port: 80
server_admin: admin@example.com
```

ЁЯУБ `host_vars/192.168.56.101.yml`:
```yaml
nginx_root: /var/www/html
```

---

## ЁЯза **Facts ржХрзА?**

Ansible **automatically gather** ржХрж░рзЗ ржпрзЗржХрзЛржирзЛ host/server-ржПрж░ hardware, software, OS, memory, IP address, CPU info ржЗрждрзНржпрж╛ржжрж┐ред

ЁЯУМ ржПржЧрзБрж▓рзЛржХрзЗ ржмрж▓рж╛ рж╣рзЯ **Facts**ред

### Check ржХрж░рждрзЗ:
```bash
ansible web -m setup
```

---

## ЁЯФН **Example: Facts ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛**

```yaml
- name: Print IP Address using facts
  hosts: web
  tasks:
    - debug:
        msg: "The default IPv4 address is {{ ansible_default_ipv4.address }}"
```

ржЖрж░рзЛ facts:
- `ansible_hostname`
- `ansible_os_family`
- `ansible_processor_cores`
- `ansible_memtotal_mb`

---

## ЁЯза **1. Conditionals in Ansible**

ржпржжрж┐ ржХрзЛржирзЛ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ рж╢рж░рзНржд ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ рж╕рзЗржЗ Task ржЪрж▓ржмрзЗред ржирж╛ рж╣рж▓рзЗ skip ржХрж░ржмрзЗред

### тЬЕ Syntax:
```yaml
when: <condition>
```

### ЁЯУМ ржЙржжрж╛рж╣рж░ржг рзз: рж╢рзБржзрзБржорж╛рждрзНрж░ Ubuntu рж╣рж▓рзЗ ржкрзНржпрж╛ржХрзЗржЬ install ржХрж░рзЛ

```yaml
- name: Install nginx only on Ubuntu
  apt:
    name: nginx
    state: present
  when: ansible_facts['os_family'] == "Debian"
```

---

### ЁЯУМ ржЙржжрж╛рж╣рж░ржг рзи: Custom Variable Check

```yaml
vars:
  install_package: true

tasks:
  - name: Conditionally install htop
    apt:
      name: htop
      state: present
    when: install_package
```

---

## ЁЯФБ **2. Loops in Ansible**

ржПржХржЯрж╛ task ржмрж╛рж░ржмрж╛рж░ run ржХрж░рж╛ржирзЛ рж╣рзЯ **loops** ржжрж┐рзЯрзЗред

### тЬЕ Syntax:
```yaml
with_items:
  - item1
  - item2
```
**ржмрж╛ ржПржЦржиржХрж╛рж░ ржирждрзБржи syntax:**
```yaml
loop:
  - item1
  - item2
```

---

### ЁЯУМ ржЙржжрж╛рж╣рж░ржг рзз: ржПржХрж╛ржзрж┐ржХ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓

```yaml
- name: Install multiple packages
  apt:
    name: "{{ item }}"
    state: present
  loop:
    - git
    - curl
    - unzip
```

---

### ЁЯУМ ржЙржжрж╛рж╣рж░ржг рзи: ржПржХрж╛ржзрж┐ржХ ржлрж╛ржЗрж▓ ржХржкрж┐

```yaml
- name: Copy multiple files
  copy:
    src: "{{ item }}"
    dest: "/tmp/{{ item }}"
  loop:
    - file1.txt
    - file2.txt
```

---

## ЁЯЫОя╕П **3. Handlers in Ansible**

ржпржЦржи ржХрзЛржирзЛ Task "Changed" рж╣рзЯ, рждржЦржи ржПржХ ржмрж╛ ржПржХрж╛ржзрж┐ржХ handler call ржХрж░рж╛ рж╣рзЯред

### тЬЕ Structure:
```yaml
tasks:
  - name: Update nginx config
    copy:
      src: nginx.conf
      dest: /etc/nginx/nginx.conf
    notify: Restart nginx

handlers:
  - name: Restart nginx
    service:
      name: nginx
      state: restarted
```

> тЬЕ Notify only runs handler **if** that task made a **change**

---

## ЁЯзк **рж╕ржорзНржкрзВрж░рзНржг ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг: Condition + Loop + Handler**

```yaml
---
- name: Install apps & configure NGINX
  hosts: web
  become: yes
  vars:
    my_packages:
      - htop
      - tree
      - nginx
    install_nginx: true

  tasks:
    - name: Install all basic packages
      apt:
        name: "{{ item }}"
        state: present
      loop: "{{ my_packages }}"

    - name: Copy nginx config only if allowed
      copy:
        src: nginx.conf
        dest: /etc/nginx/nginx.conf
      when: install_nginx
      notify: Restart nginx

  handlers:
    - name: Restart nginx
      service:
        name: nginx
        state: restarted
```

---

## ЁЯза **Ansible Role ржХрзА?**

Role рж╣рж▓рзЛ Ansible-ржПрж░ ржПржХржЯрж┐ best practice structure  
ЁЯСЙ ржпрж╛ task, variable, template, file, handler тАФ рж╕ржмржХрж┐ржЫрзБржХрзЗ **modular & reusable** ржХрж░рзЗ рждрзЛрж▓рзЗред

ЁЯОп ржЖржкржирж┐ ржПржХржмрж╛рж░ Role ржмрж╛ржирж╛ржмрзЗржи, рждрж╛рж░ржкрж░ рж╕рзЗржЯрж╛ ржпрзЗ ржХрзЛржирзЛ project-ржП import ржХрж░рзЗ ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░ржмрзЗржи!

---

## ЁЯУБ **Role Structure:**

```bash
roles/
тФФтФАтФА nginx_setup/
    тФЬтФАтФА tasks/
    тФВ   тФФтФАтФА main.yml
    тФЬтФАтФА handlers/
    тФВ   тФФтФАтФА main.yml
    тФЬтФАтФА templates/
    тФВ   тФФтФАтФА nginx.conf.j2
    тФЬтФАтФА files/
    тФВ   тФФтФАтФА index.html
    тФЬтФАтФА vars/
    тФВ   тФФтФАтФА main.yml
    тФФтФАтФА defaults/
        тФФтФАтФА main.yml
```

---

## ЁЯЫая╕П **Role рждрзИрж░рж┐ ржХрж░рж╛рж░ ржХржорж╛ржирзНржб:**

```bash
ansible-galaxy init roles/nginx_setup
```

---

## ЁЯУЭ **roles/nginx_setup/tasks/main.yml**

```yaml
---
- name: Install Nginx
  apt:
    name: nginx
    state: present
    update_cache: yes

- name: Copy index.html
  copy:
    src: index.html
    dest: /var/www/html/index.html

- name: Copy Nginx config
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
  notify: Restart nginx
```

---

## ЁЯЫОя╕П **roles/nginx_setup/handlers/main.yml**

```yaml
---
- name: Restart nginx
  service:
    name: nginx
    state: restarted
```

---

## ЁЯУЬ **Playbook ржерзЗржХрзЗ Role Call:**

```yaml
---
- name: Deploy Web Server using Role
  hosts: web
  become: yes
  roles:
    - nginx_setup
```

ЁЯУБ Playbook ржПрж░ ржкрж╛рж╢рзЗржЗ `roles/` ржлрзЛрж▓рзНржбрж╛рж░ ржерж╛ржХржмрзЗред

---

## ЁЯОп **Variable & Template Support**

ЁЯУБ `roles/nginx_setup/templates/nginx.conf.j2`:
```nginx
server {
    listen {{ http_port }};
    server_name localhost;

    location / {
        root /var/www/html;
        index index.html;
    }
}
```

ЁЯУБ `roles/nginx_setup/defaults/main.yml`:
```yaml
http_port: 80
```

---

## ЁЯФе **Production Tips:**

| Tip | ржмрзНржпрж╛ржЦрзНржпрж╛ |
|-----|----------|
| `defaults/` | low-priority variables (can override later) |
| `vars/` | high-priority variables |
| `handlers/` | config ржкрж░рж┐ржмрж░рзНрждржирзЗ service restart/notify |
| `files/` | static file copy |
| `templates/` | dynamic file with Jinja2 variables |
| `meta/` | dependencies, author info (optional) |

---

## ЁЯТб **Mini Project Idea:**

тЬЕ ржПржХржЯрж┐ Role ржмрж╛ржирж╛ржи `apache_setup` ржирж╛ржорзЗ  
тЬЕ ржпрж╛ Apache install ржХрж░рзЗ  
тЬЕ index.html ржжрзЗрзЯ  
тЬЕ template config ржжрзЗрзЯ  
тЬЕ restart handler ржжрзЗрзЯ

---

## ЁЯза **Ansible Vault ржХрзА?**

Ansible Vault ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржкржирж┐ ржпрзЗржХрзЛржирзЛ ржлрж╛ржЗрж▓ (ржмрж┐рж╢рзЗрж╖ ржХрж░рзЗ variables) ржХрзЗ encrypt ржХрж░рзЗ рж░рж╛ржЦрждрзЗ ржкрж╛рж░рзЗржиред  
ЁЯСЙ ржпрж╛рждрзЗ ржХрзЗржЙ YAML ржлрж╛ржЗрж▓ ржЦрзБрж▓рж▓рзЗржУ sensitive data ржирж╛ ржжрзЗржЦрждрзЗ ржкрж╛рзЯред

---

## ЁЯФР **Vault ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ рж╕ржорзЯрзЗрж░ ржЙржжрж╛рж╣рж░ржг:**

- `db_password: mysecretpass`
- `api_token: 3fk2r23kfd...`
- `smtp_auth_password: yourpass123`

---

## ЁЯЫая╕П **Vault ржлрж╛ржЗрж▓ рждрзИрж░рж┐ (encrypt):**

```bash
ansible-vault create secrets.yml
```

тЮбя╕П ржПржЯрж┐ ржЖржкржирж╛ржХрзЗ ржПржХржЯрж┐ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржЪрж╛ржЗржмрзЗ  
тЮбя╕П ржПрж░ржкрж░ vi editor-ржП рж▓рж┐ржЦрзБржи:

```yaml
db_user: root
db_pass: VerySecret123
```

рж╕рзЗржн ржХрж░рж▓рзЗ ржкрзБрж░рзЛ ржлрж╛ржЗрж▓ encrypted ржерж╛ржХржмрзЗ!

---

## ЁЯФУ **Vault ржлрж╛ржЗрж▓ ржЦрзЛрж▓рж╛ (decrypt ржХрж░рзЗ read):**

```bash
ansible-vault view secrets.yml
```

---

## тЬПя╕П **Vault ржлрж╛ржЗрж▓ ржПржбрж┐ржЯ ржХрж░рж╛ (edit):**

```bash
ansible-vault edit secrets.yml
```

---

## ЁЯФБ **Existing ржлрж╛ржЗрж▓ Encrypt ржХрж░рж╛:**

```bash
ansible-vault encrypt vars.yml
```

---

## ЁЯФУ **Vault Remove ржХрж░рзЗ Normal file ржХрж░рж╛ (decrypt):**

```bash
ansible-vault decrypt secrets.yml
```

---

## ЁЯУЬ **Playbook-ржП Vault file ржмрзНржпржмрж╣рж╛рж░:**

ЁЯУБ `secrets.yml` (encrypted)  
ЁЯУБ `main.yml` playbook:

```yaml
---
- name: Use secure DB credentials
  hosts: db
  become: yes
  vars_files:
    - secrets.yml
  tasks:
    - debug:
        msg: "My DB password is {{ db_pass }}"
```

тЮбя╕П рж░рж╛ржи ржХрж░рж╛рж░ рж╕ржорзЯ ржЖржкржирж╛ржХрзЗ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржжрж┐рждрзЗ рж╣ржмрзЗ:

```bash
ansible-playbook main.yml --ask-vault-pass
```

---

## ЁЯФР **Vault Password File (auto auth):**

ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржмрж╛рж░ржмрж╛рж░ ржжрж┐рждрзЗ ржирж╛ ржЪрж╛ржЗрж▓рзЗ ржПржХржЯрж╛ text ржлрж╛ржЗрж▓рзЗ рж░рзЗржЦрзЗ ржжрж┐ржи:

ЁЯУБ `vault_pass.txt`:
```
MySuperVaultPass
```

Then рж░рж╛ржи ржХрж░рзБржи:

```bash
ansible-playbook main.yml --vault-password-file vault_pass.txt
```

> тЪая╕П ржХрж┐ржирзНрждрзБ ржПржЗ ржлрж╛ржЗрж▓ `gitignore` ржХрж░рзЗ рж░рж╛ржЦрждрзЗ ржнрзБрж▓ржмрзЗржи ржирж╛!

---

## тЬЕ **Best Practices (Security Guide):**

| Practice | ржмрзНржпрж╛ржЦрзНржпрж╛ |
|----------|---------|
| Use `vault` for all passwords | Database, Token, Email password |
| Use `.gitignore` for `*.txt`, `*.vault` files | ржпрж╛рждрзЗ ржХржЦржиржУ ржЧрж┐ржЯрзЗ ржирж╛ ржпрж╛рзЯ |
| Separate secret file per environment | ex: `prod_secrets.yml`, `dev_secrets.yml` |
| Use Ansible Roles with `vars_files` | Role-ржнрж┐рждрзНрждрж┐ржХ ржЧрзЛржкржи рждржерзНржп ржмрзНржпржмрж╣рж╛рж░ |
| Rotate your vault password | ржирж┐рзЯржорж┐ржд ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи |

---

# ЁЯУШ **Dynamic Inventory & Real-Time Use Cases **

---

## ЁЯОп **ржЙржжрзНржжрзЗрж╢рзНржп:**
- Static vs Dynamic Inventory
- Dynamic Inventory ржХрзА ржУ ржХрзЗржи ржжрж░ржХрж╛рж░
- AWS EC2 Dynamic Inventory Example
- Ansible Inventory Script ржмрж╛ Plugin
- ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржгрзЗ ржмрзНржпржмрж╣рж╛рж░

---

## ЁЯза **1. Static Inventory vs Dynamic Inventory**

### ЁЯУД Static Inventory Example:
```ini
[web]
192.168.1.10
192.168.1.11

[db]
192.168.1.20
```

ЁЯСЙ IP ржмрж╛ Hostname ржорзНржпрж╛ржирзБрзЯрж╛рж▓рж┐ рж▓рж┐ржЦрждрзЗ рж╣рзЯред

---

### ЁЯМР Dynamic Inventory:
- Dynamic inventory script/ржкрзНрж▓рж╛ржЧрж┐ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕рж╛рж░рзНржнрж╛рж░ рж▓рж┐рж╕рзНржЯ **рж╕рзНржмрзЯржВржХрзНрж░рж┐рзЯржнрж╛ржмрзЗ fetch** ржХрж░рж╛ рж╣рзЯред
- ржЖржкржирж╛рж░ ржЕржирж▓рж╛ржЗржи рж╕рж╛рж░рзНржнрж╛рж░ (AWS, Azure, GCP, VMware, etc.) ржерзЗржХрзЗ live inventory ржирж┐рзЯрзЗ ржХрж╛ржЬ ржХрж░рзЗред

---

## тЪЩя╕П **2. AWS EC2 Dynamic Inventory Example (Plugin Method)**

### ЁЯФз ржзрж╛ржк рзз: ржкрзНрж▓рж╛ржЧржЗржи ржЗржирж╕рзНржЯрж▓
```bash
pip install boto boto3 botocore
```

### ЁЯФз ржзрж╛ржк рзи: AWS Credential рж╕рзЗржЯ ржХрж░рзБржи:
```bash
export AWS_ACCESS_KEY_ID=YOUR_KEY
export AWS_SECRET_ACCESS_KEY=YOUR_SECRET
```

### ЁЯФз ржзрж╛ржк рзй: Inventory Plugin config ржлрж╛ржЗрж▓ (aws_ec2.yml)

```yaml
plugin: aws_ec2
regions:
  - ap-south-1
keyed_groups:
  - key: tags.Name
    prefix: tag
filters:
  instance-state-name: running
```

> ЁЯФР `aws_ec2.yml` ржлрж╛ржЗрж▓ржЯрж┐ Ansible 2.9+ ржнрж╛рж░рзНрж╕ржирзЗ Plug-and-play!

---

## ЁЯФО **Run inventory check:**

```bash
ansible-inventory -i aws_ec2.yml --list
```

ЁЯФД ржПржЯрж┐ ржЖржкржирж╛рж░ AWS ржерзЗржХрзЗ EC2 instance ржЧрзБрж▓рзЛрж░ рждржерзНржп ржирж┐рзЯрзЗ ржЖрж╕ржмрзЗ!

---

## ЁЯФе **3. Custom Dynamic Inventory Script**

Ansible ржЖржкржирж╛ржХрзЗ Python/Bash ржжрж┐рзЯрзЗ ржирж┐ржЬрзЗрж░ custom script рж▓рзЗржЦрж╛рж░ рж╕рзБржмрж┐ржзрж╛ ржжрзЗрзЯред

### тЬЕ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рж╢рж░рзНржд:
- JSON format output ржжрж┐рждрзЗ рж╣ржмрзЗ
- `--list` ржжрж┐рзЯрзЗ inventory ржжрзЗржЦрж╛рждрзЗ рж╣ржмрзЗ

### ржЙржжрж╛рж╣рж░ржг (Python):
```python
#!/usr/bin/env python3
import json

inventory = {
    "web": {
        "hosts": ["192.168.1.10", "192.168.1.11"],
    },
    "_meta": {
        "hostvars": {}
    }
}
print(json.dumps(inventory))
```

### рж░рж╛ржи ржХрж░рж╛рж░ рж╕ржорзЯ:
```bash
ansible -i my_inventory.py all -m ping
```

---

## ЁЯУж **4. Real-Time Use Case: Deploying Code to AWS**

```yaml
---
- name: Deploy to dynamic AWS EC2
  hosts: tag_WebServer
  become: yes
  tasks:
    - name: Pull latest code
      git:
        repo: https://github.com/myapp/repo.git
        dest: /var/www/html
```

ЁЯУМ ржПржЦрж╛ржирзЗ `tag_WebServer` рж╣ржЪрзНржЫрзЗ EC2-ржПрж░ tag ржерзЗржХрзЗ ржмрж╛ржирж╛ржирзЛ groupред

---

# ЁЯУШ **Day 9: Ansible with CI/CD Pipelines (GitHub Actions & Jenkins)**

---

## ЁЯОп **ржЙржжрзНржжрзЗрж╢рзНржп:**
- CI/CD ржХрзАржнрж╛ржмрзЗ Ansible ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ
- GitHub Actions ржерзЗржХрзЗ Ansible ржЪрж╛рж▓рж╛ржирзЛ
- Jenkins ржерзЗржХрзЗ Ansible job ржЪрж╛рж▓рж╛ржирзЛ
- ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржгрзЗ deploy automation

---

## ЁЯза **1. CI/CD + Ansible ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ?**

CI/CD Pipeline ржпржЦржи ржХрзЛржб push ржХрж░рзЗ:
- Ansible automatically рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржЧрж┐рзЯрзЗ config/app deploy ржХрж░рзЗ
- Deployment becomes **fully automated** & repeatable
- No manual login needed anymore!

---

## ЁЯЪА **2. GitHub Actions ржерзЗржХрзЗ Ansible ржЪрж╛рж▓рж╛ржирзЛ**

### ЁЯУБ `.github/workflows/deploy.yml`

```yaml
name: Deploy with Ansible

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.10

    - name: Install Ansible
      run: |
        pip install ansible

    - name: Run Ansible Playbook
      run: |
        ansible-playbook playbook.yml -i inventory.ini --extra-vars "env=prod"
      env:
        ANSIBLE_HOST_KEY_CHECKING: "False"
```

тЬЕ ржпржжрж┐ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░рзЗ SSH key set ржХрж░рж╛ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ workflow ржерзЗржХрзЗржЗ deploy рж╣ржмрзЗ!

---

### ЁЯФР **Security Tip:**
- Use **GitHub Secrets** for:
  - SSH_PRIVATE_KEY
  - VAULT_PASSWORD
- Inject those into GitHub Actions securely.

---

## ЁЯз░ **3. Jenkins ржерзЗржХрзЗ Ansible ржЪрж╛рж▓рж╛ржирзЛ**

### ЁЯФз ржзрж╛ржк рзз: Jenkins Server-ржП:
- Install Ansible: `sudo apt install ansible`
- Add SSH credentials via Jenkins UI

### ЁЯФз ржзрж╛ржк рзи: Job рждрзИрж░рж┐ ржХрж░рзБржи:
- Freestyle Project тЮЬ Build Steps тЮЬ Execute Shell

```bash
cd $WORKSPACE
ansible-playbook playbook.yml -i inventory.ini
```

### ЁЯУж Optional:
- GitHub Webhook ржжрж┐рзЯрзЗ auto-trigger ржХрж░рзБржи

---

## ЁЯТб **4. ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг: Auto Deploy Node.js App**

ЁЯУБ `deploy_app.yml`
```yaml
---
- name: Deploy Node.js App
  hosts: app
  become: yes

  tasks:
    - name: Pull code
      git:
        repo: 'https://github.com/yourname/node-app.git'
        dest: /opt/app

    - name: Install dependencies
      npm:
        path: /opt/app

    - name: Restart app
      systemd:
        name: nodeapp
        state: restarted
```

---

# ЁЯУШ **End-to-End Ansible Automation Project**

---

## ЁЯОп ржЙржжрзНржжрзЗрж╢рзНржп:
- ржПржХржЯрж┐ end-to-end real-life automation use case
- Project structure ржХрзЗржоржи рж╣ржмрзЗ
- Inventory + Variables + Roles + Playbook use
- GitHub/GitLab/Jenkins ржерзЗржХрзЗ deploy
- ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржУ рж╕рзНржХрзЗрж▓рзЗржмрж▓рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛

---

## ЁЯз▒ **Project Scenario: Deploy LEMP Stack (Linux, Nginx, MySQL, PHP) with Laravel App**

> **ржЙржжрзНржжрзЗрж╢рзНржп:**  
Ubuntu рж╕рж╛рж░рзНржнрж╛рж░рзЗ LEMP stack configure ржХрж░рзЗ, Laravel app deploy ржХрж░рж╛ рж╣ржмрзЗ тАФ ржкрзБрж░рзЛржЯрж╛ржЗ Ansible ржжрж┐рзЯрзЗ, automated.

---

## ЁЯУБ **1. Project Folder Structure**

```
ansible-lemp-project/
тФЬтФАтФА inventory/
тФВ   тФФтФАтФА production.ini
тФЬтФАтФА group_vars/
тФВ   тФФтФАтФА all.yml
тФЬтФАтФА roles/
тФВ   тФЬтФАтФА nginx/
тФВ   тФВ   тФЬтФАтФА tasks/
тФВ   тФВ   тФФтФАтФА templates/
тФВ   тФЬтФАтФА mysql/
тФВ   тФЬтФАтФА php/
тФВ   тФФтФАтФА laravel/
тФЬтФАтФА playbook.yml
тФФтФАтФА vault_pass.txt
```

---

## ЁЯУЬ **2. Inventory File: `production.ini`**

```ini
[web]
192.168.56.10 ansible_user=ubuntu ansible_ssh_private_key_file=~/.ssh/id_rsa
```

---

## ЁЯФР **3. Group Variables: `group_vars/all.yml`**

```yaml
db_user: root
db_pass: "{{ vault_db_pass }}"
app_repo: "https://github.com/yourname/laravel-app.git"
```

**Vault-encrypted file:** `vault.yml`  
```yaml
vault_db_pass: MySecretPass123
```

Encrypt it:
```bash
ansible-vault encrypt vault.yml
```

---

## ЁЯзй **4. Roles Overview**

### тЬЕ Role: `nginx`

- Install Nginx
- Configure VirtualHost
- Start service

### тЬЕ Role: `mysql`

- Install MySQL
- Create Database
- Secure root password

### тЬЕ Role: `php`

- Install PHP & extensions

### тЬЕ Role: `laravel`

- Clone app from GitHub
- Install composer dependencies
- Set file permissions
- Run `php artisan migrate`

---

## тЦ╢я╕П **5. Main Playbook: `playbook.yml`**

```yaml
---
- name: Setup LEMP and deploy Laravel
  hosts: web
  become: yes
  vars_files:
    - group_vars/all.yml
    - vault.yml

  roles:
    - nginx
    - mysql
    - php
    - laravel
```

---

## ЁЯЪА **6. Run the Project**

```bash
ansible-playbook -i inventory/production.ini playbook.yml --vault-password-file vault_pass.txt
```

---

## ЁЯЫбя╕П **7. Bonus: GitHub Actions Integration**

ЁЯУБ `.github/workflows/deploy.yml`:

```yaml
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: pip install ansible
      - run: ansible-playbook -i inventory/production.ini playbook.yml --vault-password-file vault_pass.txt
```

---

# ЁЯУШ  Docker Automation with Ansible

---

## ЁЯОп ржЙржжрзНржжрзЗрж╢рзНржп:
- Docker install & configure with Ansible
- Docker container deploy (nginx, redis etc.)
- Custom Docker image build ржХрж░рж╛
- Docker volume, network, env manage
- ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг: Laravel ржЕрзНржпрж╛ржк Docker container-ржП deploy

---

## ЁЯз░ 1. ржкрзНрж░рзЯрзЛржЬржирзАрзЯрждрж╛:
- ржПржХржЯрж┐ Ubuntu Server (local/VM/cloud)
- Ansible installed on control machine
- Target server-ржП SSH access

---

## ЁЯз▒ 2. Project Structure:

```bash
docker-ansible/
тФЬтФАтФА inventory.ini
тФЬтФАтФА playbook.yml
тФФтФАтФА roles/
    тФФтФАтФА docker/
        тФЬтФАтФА tasks/
        тФВ   тФФтФАтФА main.yml
        тФФтФАтФА templates/
```

---

## ЁЯУД 3. Inventory File: `inventory.ini`

```ini
[servers]
192.168.56.10 ansible_user=ubuntu ansible_ssh_private_key_file=~/.ssh/id_rsa
```

---

## ЁЯУЭ 4. Docker Role Task File: `roles/docker/tasks/main.yml`

```yaml
---
- name: Install required packages
  apt:
    name: [apt-transport-https, ca-certificates, curl, gnupg, lsb-release]
    update_cache: yes

- name: Add Docker GPG key
  apt_key:
    url: https://download.docker.com/linux/ubuntu/gpg
    state: present

- name: Add Docker repository
  apt_repository:
    repo: "deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable"
    state: present

- name: Install Docker
  apt:
    name: docker-ce
    state: latest
    update_cache: yes

- name: Start and enable Docker
  service:
    name: docker
    state: started
    enabled: yes
```

---

## ЁЯЪА 5. Main Playbook: `playbook.yml`

```yaml
---
- name: Install Docker on Remote Server
  hosts: servers
  become: yes

  roles:
    - docker
```

---

## тЦ╢я╕П 6. рж░рж╛ржи ржХрж░рзБржи:

```bash
ansible-playbook -i inventory.ini playbook.yml
```

---

## ЁЯзк 7. Practical Example: Run nginx container

```yaml
- name: Run Nginx Container
  hosts: servers
  become: yes
  tasks:
    - name: Pull nginx image
      docker_image:
        name: nginx
        source: pull

    - name: Run nginx container
      docker_container:
        name: nginx_web
        image: nginx
        state: started
        ports:
          - "80:80"
```

тЬЕ Save above in a new playbook `nginx.yml` and run it:
```bash
ansible-playbook -i inventory.ini nginx.yml
```

---

## ЁЯТб ржЖрж░ржУ Practical Ideas:
| Use Case              | Module           | What it does                          |
|-----------------------|------------------|---------------------------------------|
| Run Redis container   | `docker_container` | Run redis in background               |
| Build image from Dockerfile | `docker_image`    | Build custom Laravel app image        |
| Volume mount         | `docker_container` | Mount data from host                  |
| Docker Compose (later) | `community.docker.docker_compose` | Multi-container deployment           |

---

