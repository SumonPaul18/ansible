ржЕржмрж╢рзНржпржЗ! ржирж┐ржЪрзЗ ржЖржкржирж╛рж░ ржХрж╛ржЩрзНржХрзНрж╖рж┐ржд ржорждрзЛ **рж╕ржорзНржкрзВрж░рзНржг ржкрзБржиржГржирж┐рж░рзНржорж╛ржг ржХрж░рж╛ `README.md`** ржлрж╛ржЗрж▓ ржжрзЗржУржпрж╝рж╛ рж╣рж▓рзЛред ржПржЯрж┐ ржЖрж░ржУ ржмрж╛рж╕рзНрждржмрж╕ржорзНржоржд, ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА-ржмрж╛ржирзНржзржм ржПржмржВ рж╕ржорзНржкрзВрж░рзНржг ржмрж┐рж╕рзНрждрж╛рж░рж┐рждред

---

# ЁЯЪА Ansible Pre-flight Playbook

> **ржЯрж╛рж░рзНржЧрзЗржЯ ржирзЛржбржЧрзБрж▓рзЛржХрзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржкрзНрж░рж╕рзНрждрзБржд ржХрж░рзБржи Ansible ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯрзЗрж░ ржЬржирзНржп**

---

## ЁЯУМ ржЙржжрзНржжрзЗрж╢рзНржп ржУ ржХрж╛рж░рзНржпржХрж╛рж░рж┐рждрж╛

ржПржЗ **Ansible Pre-flight Playbook** ржПржоржи ржПржХржЯрж┐ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ рж╕рж▓рж┐ржЙрж╢ржи ржпрж╛ ржЯрж╛рж░рзНржЧрзЗржЯ ржорзЗрж╢рж┐ржиржЧрзБрж▓рзЛржХрзЗ **Ansible ржжрзНржмрж╛рж░рж╛ ржорзНржпрж╛ржирзЗржЬ ржХрж░рж╛рж░ ржЬржирзНржп ржкрзНрж░рж╕рзНрждрзБржд** ржХрж░рзЗред ржПржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ ржЯрж╛рж░рзНржЧрзЗржЯ ржирзЛржбржЧрзБрж▓рзЛрждрзЗ:

- тЬЕ SSH рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрж╛рж▓рзБ ржУ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ ржЖржЫрзЗ
- тЬЕ SSH key-based authentication рж╕рзЗржЯ рж╣ржпрж╝рзЗржЫрзЗ
- тЬЕ NOPASSWD sudo ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ рж╕рзЗржЯ рж╣ржпрж╝рзЗржЫрзЗ
- тЬЕ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзНржпрж╛ржХрзЗржЬ (git, vim, curl, ржЗрждрзНржпрж╛ржжрж┐) ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржЖржЫрзЗ
- тЬЕ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ рж╣рж╛рж░рзНржбрзЗржирж┐ржВ (SSH, UFW) рж╕рзЗржЯ ржХрж░рж╛ ржЖржЫрзЗ

---

## ЁЯОп ржмрж╛рж╕рзНрждржм ржкрзНрж░ржпрж╝рзЛржЧ ржУ рж╕рзЗржирж╛рж░рж┐ржУ

### ЁЯзк **рж╕рзЗржирж╛рж░рж┐ржУ: ржПржХржЯрж┐ ржирждрзБржи ржХрзНрж▓рж╛ржЙржб рж▓рзНржпрж╛ржм рж╕рзЗржЯржЖржк ржХрж░рждрзЗ ржЪрж╛ржЪрзНржЫрзЗржи**

ржзрж░рзБржи ржЖржкржирж┐ ржПржХржЯрж┐ ржирждрзБржи ржкрзНрж░рж╛ржЗржнрзЗржЯ ржХрзНрж▓рж╛ржЙржб рж▓рзНржпрж╛ржм рждрзИрж░рж┐ ржХрж░ржЫрзЗржи ржпрзЗржЦрж╛ржирзЗ ржЖржкржирж╛рж░ ржирждрзБржи рждрж┐ржиржЯрж┐ рж╕рж╛рж░рзНржнрж╛рж░ рж░ржпрж╝рзЗржЫрзЗ:

- **Control Node**: `192.168.0.93` (ржпрзЗржЦрж╛ржи ржерзЗржХрзЗ Ansible ржЪрж╛рж▓рж╛ржмрзЗржи)
- **Target Nodes**: `192.168.0.94`, `192.168.0.95`, `192.168.0.96` (ржпрзЗржЧрзБрж▓рзЛ ржЖржкржирж┐ ржорзНржпрж╛ржирзЗржЬ ржХрж░ржмрзЗржи)

**ржкрзНрж░ржмрж▓рзЗржо**: ржПржЗ рждрж┐ржиржЯрж┐ ржЯрж╛рж░рзНржЧрзЗржЯ ржорзЗрж╢рж┐ржирзЗ ржХрзЛржирзЛ SSH key ржирзЗржЗ, sudo ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирзЗржЗ, ржХрж┐ржЫрзБ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржирзЗржЗред ржПржЧрзБрж▓рзЛржХрзЗ ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ рж╕рзЗржЯ ржХрж░рж╛ рж╕ржоржпрж╝рж╕рж╛ржкрзЗржХрзНрж╖ ржУ ржнрзБрж▓ржкрзНрж░ржмржгред

**рж╕ржорж╛ржзрж╛ржи**: ржПржЗ playbook ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХржмрж╛рж░рзЗ рждрж┐ржиржЯрж┐ ржорзЗрж╢рж┐ржиржХрзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржкрзНрж░рж╕рзНрждрзБржд ржХрж░рзЗ ржлрзЗрж▓рзБржиред

**ржлрж▓рж╛ржлрж▓**: ржПржХржмрж╛рж░рзЗ рждрж┐ржиржЯрж┐ ржорзЗрж╢рж┐ржирзЗ SSH key рж╕рзЗржЯ рж╣ржмрзЗ, sudo NOPASSWD ржжрзЗржУржпрж╝рж╛ рж╣ржмрзЗ, ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ рж╣ржмрзЗ ржПржмржВ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ рж╣рж╛рж░рзНржбрзЗржирж┐ржВ ржХрж░рж╛ рж╣ржмрзЗред ржЖржкржирж┐ рждржЦржи рж╕рж░рж╛рж╕рж░рж┐ Ansible ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржЧрзБрж▓рзЛржХрзЗ ржорзНржпрж╛ржирзЗржЬ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред

---

## ЁЯУе ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи

### 1. рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржХрзНрж▓рзЛржи ржХрж░рзБржи

```bash
git clone https://github.com/yourusername/ansible-pre-flight.git
cd ansible-pre-flight
```

### 2. Ansible Control Node ржП ржЗржирзНрж╕ржЯрж▓рзЗрж╢ржи

**ржзрж╛ржк 1:** ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи:

```bash
sudo apt update
sudo apt install -y ansible python3-pip sshpass
```

> **ржирзЛржЯ**: `sshpass` ржкрзНрж░ржпрж╝рзЛржЬржи ржпржжрж┐ ржЖржкржирж┐ `ansible_ssh_pass` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржиред

---

## ЁЯУБ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░

```
ansible-pre-flight/
тФЬтФАтФА README.md                    # ржПржЗ ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи
тФЬтФАтФА inventory.ini                # ржЯрж╛рж░рзНржЧрзЗржЯ рж╣рзЛрж╕рзНржЯ ржУ ржкрзНрж░рж╛ржержорж┐ржХ ржХрзНрж░рзЗржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓
тФЬтФАтФА group_vars/
тФВ   тФФтФАтФА all.yml                  # ржЧрзНрж▓рзЛржмрж╛рж▓ ржнрзНржпрж╛рж░рж┐ржпрж╝рзЗржмрж▓ (ржЗржЙржЬрж╛рж░, SSH key, UFW рж╕рзЗржЯрж┐ржВрж╕)
тФЬтФАтФА roles/
тФВ   тФФтФАтФА preflight/
тФВ       тФЬтФАтФА tasks/main.yml       # ржорзВрж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржЯрж╛рж╕рзНржХ
тФВ       тФФтФАтФА handlers/main.yml    # рж╕рж╛рж░рзНржнрж┐рж╕ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░
тФФтФАтФА site.yml                     # ржорзВрж▓ playbook ржПржирзНржЯрзНрж░рж┐ ржкржпрж╝рзЗржирзНржЯ
```

### ЁЯУД ржлрж╛ржЗрж▓ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржмрж░рзНржгржирж╛

| ржлрж╛ржЗрж▓ | ржмрж░рзНржгржирж╛ |
|------|--------|
| `inventory.ini` | ржЯрж╛рж░рзНржЧрзЗржЯ рж╣рзЛрж╕рзНржЯ(ржЧрзБрж▓рзЛ) ржПржмржВ ржкрзНрж░рж╛ржержорж┐ржХ SSH ржХрзНрж░рзЗржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ (рж╢рзБржзрзБ ржкрзНрж░ржержоржмрж╛рж░рзЗрж░ ржЬржирзНржп) |
| `group_vars/all.yml` | ржХрж╛рж╕рзНржЯржорж╛ржЗржЬрзЗржмрж▓ ржнрзНржпрж╛рж░рж┐ржпрж╝рзЗржмрж▓: ржЗржЙржЬрж╛рж░ ржирж╛ржо, SSH public key, UFW enable/disable |
| `roles/preflight/tasks/main.yml` | ржорзВрж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи: ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓, SSH key рж╕рзЗржЯржЖржк, sudo ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕, ржЗрждрзНржпрж╛ржжрж┐ |
| `roles/preflight/handlers/main.yml` | SSH рж╕рж╛рж░рзНржнрж┐рж╕ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзЗ ржпржЦржи sshd_config ржкрж░рж┐ржмрж░рзНрждржи рж╣ржпрж╝ |
| `site.yml` | playbook ржПрж░ ржПржирзНржЯрзНрж░рж┐ ржкржпрж╝рзЗржирзНржЯ тАФ `preflight` role ржХрж▓ ржХрж░рзЗ |

---

## тЪЩя╕П ржХрж╛рж╕рзНржЯржорж╛ржЗржЬрзЗрж╢ржи

### 1. **ржЗржЙржЬрж╛рж░ ржирж╛ржо ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ**
- ржлрж╛ржЗрж▓: `group_vars/all.yml`
- ржкрж░рж┐ржмрж░рзНрждржи:
  ```yaml
  preflight_user: your_custom_user
  ```
### 2. **SSH Public Key ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ**

- ржлрж╛ржЗрж▓: `group_vars/all.yml`
- ржбрж┐ржлрж▓рзНржЯ: `~/.ssh/id_rsa.pub` (control node ржерзЗржХрзЗ)
  ```yaml
  preflight_ssh_pubkey: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
  ```
-  ржЕржержмрж╛ рж╕рж░рж╛рж╕рж░рж┐ рж╕рзНржЯрзНрж░рж┐ржВ ржжрж┐ржи:
  ```yaml
  preflight_ssh_pubkey: "ssh-rsa AAAAB3NzaC1yc2E... user@host"
  ```
- ржЕржирзНржп ржХрзА ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржЪрж╛ржЗрж▓рзЗ:
  ```yaml
  preflight_ssh_pubkey: "{{ lookup('file', '/path/to/your/key.pub') }}"
  ```
### 3. **UFW ржмржирзНржз рж░рж╛ржЦрждрзЗ ржЪрж╛ржЗрж▓рзЗ**

- ржлрж╛ржЗрж▓: `group_vars/all.yml`
- ржкрж░рж┐ржмрж░рзНрждржи:
  ```yaml
  enable_ufw: false
  ```

### 4. **ржЕрждрж┐рж░рж┐ржХрзНржд ржкрзЛрж░рзНржЯ ржЕрзНржпрж╛рж▓рж╛ржЙ ржХрж░рждрзЗ**

- ржлрж╛ржЗрж▓: `roles/preflight/tasks/main.yml`
- ржирждрзБржи ржЯрж╛рж╕рзНржХ ржпрзЛржЧ ржХрж░рзБржи:
  ```yaml
  - name: Allow additional ports in UFW
    ufw:
      rule: allow
      port: "{{ item }}"
    loop: [80, 443, 8080]
    when: enable_ufw
  ```

---

 ## тЦ╢я╕П Playbook рж░рж╛ржи ржХрж░рж╛рж░ ржЧрж╛ржЗржбрж▓рж╛ржЗржи

### 1. **SSH Key ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рзБржи (ржпржжрж┐ ржирж╛ ржерж╛ржХрзЗ)**

```bash
ssh-keygen -t rsa -b 4096
# ржкрж╛рж╕ржлрзНрж░рзЗржЬ ржЫрж╛ржбрж╝рж╛ рж░рж╛ржЦрзБржи (ржпржжрж┐ ржЕржЯрзЛржорзЗрж╢ржи ржЪрж╛ржи)
```

> **SSH Key ржлрж╛ржЗрж▓ рж▓рзЛржХрзЗрж╢ржи**:  
> - Private Key: `~/.ssh/id_rsa`  
> - Public Key: `~/.ssh/id_rsa.pub`  
> 
> ржПржЗ playbook ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ `~/.ssh/id_rsa.pub` ржлрж╛ржЗрж▓ржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗред  
> ржЖржкржирж┐ ржпржжрж┐ ржЕржирзНржп ржХрзА ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржи, рждрж╛рж╣рж▓рзЗ `group_vars/all.yml` ржП ржлрж╛ржЗрж▓ ржкрж╛рже ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи:
> ```yaml
> preflight_ssh_pubkey: "{{ lookup('file', '/path/to/your/custom_key.pub') }}"
> ```

### 2. **Inventory ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи**

- ржлрж╛ржЗрж▓: `inventory.ini`
- ржЙржжрж╛рж╣рж░ржг:
  ```ini
  [target]
  192.168.0.52

  [target:vars]
  ansible_user=cloud3
  ansible_ssh_pass=YourPasswordHere
  ansible_ssh_common_args='-o StrictHostKeyChecking=no'
  ```

> **ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржмрж░рзНржгржирж╛**:
> - `[target]`: ржЯрж╛рж░рзНржЧрзЗржЯ рж╣рзЛрж╕рзНржЯржЧрзБрж▓рзЛ ржПржЦрж╛ржирзЗ рж▓рзЗржЦрж╛ рж╣ржпрж╝ред ржПржХрж╛ржзрж┐ржХ рж╣рзЛрж╕рзНржЯ рж▓рзЗржЦрж╛ ржпрж╛ржмрзЗ ржПржХ ржХрж▓рж╛ржорзЗред
> - `ansible_user=cloud3`: ржпрзЗ ржЗржЙржЬрж╛рж░ ржжрж┐ржпрж╝рзЗ SSH ржХрж░ржмрзЗред
> - `ansible_ssh_pass=YourPasswordHere`: ржкрзНрж░рж╛ржержорж┐ржХ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб (рж╢рзБржзрзБ ржкрзНрж░ржержоржмрж╛рж░рзЗрж░ ржЬржирзНржп)ред
> - `ansible_ssh_common_args='-o StrictHostKeyChecking=no'`: рж╣рзЛрж╕рзНржЯ ржХрзА ржЪрзЗржХрж┐ржВ ржмрж╛ржЗржкрж╛рж╕ ржХрж░рзЗ тАФ ржкрзНрж░ржержоржмрж╛рж░рзЗрж░ ржЬржирзНржп ржжрж░ржХрж╛рж░ред

---

## ЁЯОо ржкрзНрж▓рзЗржмрзБржХ рж░рж╛ржи ржХрж░рж╛рж░ ржХржорж╛ржирзНржб

### 1. **рж╕рж╛ржзрж╛рж░ржг рж░рж╛ржи (ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржЗржирж▓рж╛ржЗржи)**

```bash
ansible-playbook -i inventory.ini site.yml
```

> **ржмрзНржпрж╛ржЦрзНржпрж╛**:  
> - `-i inventory.ini`: inventory ржлрж╛ржЗрж▓ рж╕рзНржкрзЗрж╕рж┐ржлрж╛ржЗ ржХрж░рзЗред  
> - `site.yml`: ржорзВрж▓ playbook ржлрж╛ржЗрж▓ред  
> - ржПржЯрж┐ ржкрзНрж░ржержоржмрж╛рж░рзЗрж░ ржЬржирзНржп рж╕ржмржЪрзЗржпрж╝рзЗ рж╕рж╣ржЬ ржЙржкрж╛ржпрж╝ред  
> - **рж╕рждрж░рзНржХрждрж╛**: `inventory.ini` ржП ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб plaintext ржерж╛ржХрзЗ тАФ ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи ржирж╛ред

### 2. **`--ask-pass` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ (ржирж┐рж░рж╛ржкржж)**

```bash
ansible-playbook -i inventory.ini site.yml --ask-pass
```

> **ржмрзНржпрж╛ржЦрзНржпрж╛**:  
> - `--ask-pass`: ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржЗржиржкрзБржЯ рж╣рж┐рж╕рзЗржмрзЗ ржЪрж╛ржЗржмрзЗред  
> - ржлрж╛ржЗрж▓рзЗ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржерж╛ржХрзЗ ржирж╛ред  
> - **рж╕рзБржмрж┐ржзрж╛**: ржирж┐рж░рж╛ржкржж, ржкрзНрж░рж╛ржЗржнрзЗржЯ рж▓рзНржпрж╛ржмрзЗ ржЖржжрж░рзНрж╢ред  
> - **ржЕрж╕рзБржмрж┐ржзрж╛**: ржкрзНрж░рждрж┐ржмрж╛рж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐рждрзЗ рж╣ржмрзЗред

### 3. **`ansible-vault` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ (рж╕рзЗрж░рж╛ ржЙржкрж╛ржпрж╝)**

**ржзрж╛ржк 1:** ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржнрж▓рзНржЯрзЗ рж╕рзЗржн ржХрж░рзБржи:

```bash
ansible-vault create group_vars/all/vault.yml
# ржнрж┐рждрж░рзЗ рж▓рж┐ржЦрзБржи:
# ansible_ssh_pass: YourPasswordHere
```

**ржзрж╛ржк 2:** `inventory.ini` ржерзЗржХрзЗ `ansible_ssh_pass` рж▓рж╛ржЗржи ржорзБржЫрзЗ ржлрзЗрж▓рзБржиред

**ржзрж╛ржк 3:** `group_vars/all.yml` ржП ржнрж▓рзНржЯ ржнрзНржпрж╛рж░рж┐ржпрж╝рзЗржмрж▓ ржпрзЛржЧ ржХрж░рзБржи:

```yaml
---
# group_vars/all.yml
preflight_user: cloud3
preflight_ssh_pubkey: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
enable_ufw: true

# ржнрж▓рзНржЯ ржерзЗржХрзЗ рж▓рзЛржб
ansible_ssh_pass: "{{ vault_ansible_ssh_pass }}"
```

**ржзрж╛ржк 4:** Playbook рж░рж╛ржи ржХрж░рзБржи:

```bash
ansible-playbook -i inventory.ini site.yml --ask-vault-pass
```

> **ржмрзНржпрж╛ржЦрзНржпрж╛**:  
> - `--ask-vault-pass`: ржнрж▓рзНржЯ ржбрж┐ржХрзНрж░рж┐ржкрзНржЯ ржХрж░рждрзЗ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржЪрж╛ржЗржмрзЗред  
> - **рж╕рзБржмрж┐ржзрж╛**: ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб encrypted, ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ ржЖржжрж░рзНрж╢ред  
> - **ржЕрж╕рзБржмрж┐ржзрж╛**: ржПржХржЯрзБ ржХржоржкрзНрж▓рзЗржХрзНрж╕ рж╕рзЗржЯржЖржкред

### 4. **`--ask-become-pass` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ (ржпржжрж┐ sudo ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж▓рж╛ржЧрзЗ)**

```bash
ansible-playbook -i inventory.ini site.yml --ask-pass --ask-become-pass
```

> **ржмрзНржпрж╛ржЦрзНржпрж╛**:  
> - `--ask-become-pass`: sudo ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржЪрж╛ржЗржмрзЗред  
> - ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи ржпржжрж┐ `cloud3` ржЗржЙржЬрж╛рж░рзЗрж░ sudo ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐рждрзЗ рж╣ржпрж╝ред


#### 5. **ржкрж░ржмрж░рзНрждрзА ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржЬржирзНржп**:
   - `inventory.ini` ржерзЗржХрзЗ `ansible_ssh_pass` рж▓рж╛ржЗржи **ржорзБржЫрзЗ ржлрзЗрж▓рзБржи**
   - ржПржЦржи ржерзЗржХрзЗ key-based auth ржХрж╛ржЬ ржХрж░ржмрзЗ

> тЬЕ **рж╕рзБрж░ржХрзНрж╖рж╛ ржЯрж┐ржк**: ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ `ansible_ssh_pass` ржмрзНржпржмрж╣рж╛рж░ ржирж╛ ржХрж░рзЗ `--ask-pass` ржЕржержмрж╛ `ansible-vault` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред

---

## тЬЕ ржнрзЗрж░рж┐ржлрж┐ржХрзЗрж╢ржи: ржкрж░рж┐ржмрж░рзНрждржиржЧрзБрж▓рзЛ ржЪрзЗржХ ржХрж░рзБржи

Playbook рж╕ржлрж▓ржнрж╛ржмрзЗ рж░рж╛ржи рж╣ржУржпрж╝рж╛рж░ ржкрж░ ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржбржЧрзБрж▓рзЛ ржжрж┐ржпрж╝рзЗ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи:

```bash
# 1. SSH key-based login ржХрж╛ржЬ ржХрж░ржЫрзЗ?
ssh cloud3@192.168.0.94 'echo "тЬЕ Key auth works!"'

# 2. Password auth ржмржирзНржз рж╣ржпрж╝рзЗржЫрзЗ?
ssh cloud3@192.168.0.94 'grep "^PasswordAuthentication" /etc/ssh/sshd_config'
# ржЖржЙржЯржкрзБржЯ: PasswordAuthentication no

# 3. NOPASSWD sudo ржХрж╛ржЬ ржХрж░ржЫрзЗ?
ssh cloud3@192.168.0.94 'sudo -n whoami'
# ржЖржЙржЯржкрзБржЯ: root (ржХрзЛржирзЛ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржЪрж╛ржЗржмрзЗ ржирж╛)

# 4. UFW ржЪрж╛рж▓рзБ ржУ SSH ржЕрзНржпрж╛рж▓рж╛ржЙржб?
ssh cloud3@192.168.0.94 'sudo ufw status verbose'

# 5. ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ рж╣ржпрж╝рзЗржЫрзЗ?
ssh cloud3@192.168.0.94 'dpkg -l | grep -E "openssh-server|git|htop"'
```

---

## ЁЯУМ ржирзЛржЯ

- ржПржЗ playbook **idempotent** тАФ ржПржХрж╛ржзрж┐ржХржмрж╛рж░ ржЪрж╛рж▓рж╛рж▓рзЗ ржХрзЛржирзЛ ржбрзБржкрзНрж▓рж┐ржХрзЗржЯ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи рждрзИрж░рж┐ рж╣ржмрзЗ ржирж╛ред
- ржкрзНрж░ржержоржмрж╛рж░ **password-based SSH** ржкрзНрж░ржпрж╝рзЛржЬржи, ржкрж░рзЗ **key-based** рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝ред
- ржЖржкржирж╛рж░ **OpenStack/kolla-ansible** ржбрж┐ржкрзНрж▓ржпрж╝ржорзЗржирзНржЯрзЗрж░ ржЖржЧрзЗ ржПржЯрж┐ ржЪрж╛рж▓рж╛ржирзЛ ржЖржжрж░рзНрж╢ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ред

---

## тЪая╕П рж╕ржорзНржнрж╛ржмрзНржп рждрзНрж░рзБржЯрж┐ ржУ рж╕ржорж╛ржзрж╛ржи

| рждрзНрж░рзБржЯрж┐                                                                                                                                                                       | ржХрж╛рж░ржг                                                    | рж╕ржорж╛ржзрж╛ржи                                                                                                                   |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| `fatal: [192.168.0.52]: FAILED! => {"msg": "to use the 'ssh' connection type with passwords or pkcs11_provider, you must install the sshpass program"}`                      | `sshpass` ржЗржирж╕рзНржЯрж▓ ржирзЗржЗ                                    | `sudo apt install sshpass` ржХржорж╛ржирзНржб ржжрж┐ржи                                                                                    |
| `fatal: [192.168.0.52]: FAILED! => {"msg": "Using a SSH password instead of a key is not possible because Host Key checking is enabled and sshpass does not support this."}` | SSH рж╣рзЛрж╕рзНржЯ ржХрзА ржЪрзЗржХрж┐ржВ ржЪрж╛рж▓рзБ                                 | `inventory.ini` ржП `ansible_ssh_common_args='-o StrictHostKeyChecking=no'` ржпрзЛржЧ ржХрж░рзБржи                                       |
| `fatal: [192.168.0.52]: FAILED! => {"msg": "Missing sudo password"}`                                                                                                         | `become` ржПрж░ ржЬржирзНржп sudo ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж▓рж╛ржЧрзЗ                   | `--ask-become-pass` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи ржЕржержмрж╛ `ansible_become_pass` рж╕рзЗржЯ ржХрж░рзБржи                                                     |
| `UNREACHABLE! => ssh connection failed`                                                                                                                                      | ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ/SSH рж╕ржорж╕рзНржпрж╛                                   | `ping 192.168.0.52`, `ssh cloud3@192.168.0.52` ржЪрзЗржХ ржХрж░рзБржи                                                                  |
| `Authentication or permission failure`                                                                                                                                       | SSH key рж╕рзЗржЯ рж╣ржпрж╝ржирж┐ ржмрж╛ sudo ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирзЗржЗ                 | Playbook рж╢рзЗрж╖ рж╣ржУржпрж╝рж╛рж░ ржкрж░ ржЪрзЗржХ ржХрж░рзБржи: `ssh cloud3@192.168.0.52`, `sudo -n whoami`                                             |
| `Could not create temporary directory`                                                                                                                                       | SSH ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи рж╕ржорж╕рзНржпрж╛                                   | `~/.ssh` ржПржмржВ `~/.ssh/authorized_keys` ржлрж╛ржЗрж▓рзЗрж░ ржкрж╛рж░ржорж┐рж╢ржи ржЪрзЗржХ ржХрж░рзБржи: `chmod 700 ~/.ssh`, `chmod 600 ~/.ssh/authorized_keys`    |
| `lookup plugin (file) failed`                                                                                                                                                | Control node-ржП┬а`~/.ssh/id_rsa.pub`┬аржирзЗржЗ                  | -┬а`ssh-keygen`┬аржЪрж╛рж▓рж╛ржи  <br>- ржЕржержмрж╛┬а`group_vars/all.yml`-ржП рж╕рж░рж╛рж╕рж░рж┐ public key ржжрж┐ржи                                            |
| `Failed to restart ssh`                                                                                                                                                      | `sshd_config` рж╕рж┐ржиржЯрзНржпрж╛ржХрзНрж╕ ржПрж░рж░                            | - `sudo sshd -t` ржжрж┐ржпрж╝рзЗ config ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи<br>- Playbook ржЕржЯрзЛ ржмрзНржпрж╛ржХржЖржк ржирзЗржпрж╝ (`/etc/ssh/sshd_config.bak`) тАФ рж╕рзЗржЯрж┐ рж░рж┐рж╕рзНржЯрзЛрж░ ржХрж░рзБржи |
| `UNREACHABLE! "Failed to connect to the host via ssh"`                                                                                                                       | Target node-ржП SSH ржЪрж╛рж▓рзБ ржирзЗржЗ, ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржЗрж╕рзНржпрзБ, ржмрж╛ ржнрзБрж▓ IP | - `ping 192.168.0.94` ржЪрзЗржХ ржХрж░рзБржи<br>- Target-ржП `sudo systemctl status ssh` ржЪрж╛рж▓рж╛ржи<br>- Firewall/UFW ржЪрзЗржХ ржХрж░рзБржи                |
| `Authentication failed`                                                                                                                                                      | ржнрзБрж▓ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржмрж╛ ржЗржЙржЬрж╛рж░ ржирзЗржЗ                             | - `inventory.ini`-ржП рж╕ржарж┐ржХ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐ржи<br>- Target-ржП `id cloud3` ржжрж┐ржпрж╝рзЗ ржЗржЙржЬрж╛рж░ ржЖржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзБржи                          |

---


## ЁЯФД ржЖржкржбрзЗржЯ ржкрзНрж▓рзНржпрж╛ржи

- [ ] ржЖрж░ржУ ржЕржкрж╛рж░рзЗржЯрж┐ржВ рж╕рж┐рж╕рзНржЯрзЗржо рж╕рж╛ржкрзЛрж░рзНржЯ (CentOS, Rocky Linux)
- [ ] ржХржиржлрж┐ржЧрж╛рж░рзЗржмрж▓ ржлрж╛ржпрж╝рж╛рж░ржУржпрж╝рж╛рж▓ рж░рзБрж▓рж╕
- [ ] ржЯрзЗрж╕рзНржЯрж┐ржВ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржпрзЛржЧ
- [ ] CI/CD ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи

---

## ЁЯдЭ ржХржирзНржЯрзНрж░рж┐ржмрж┐ржЙрж╢ржи

ржпрзЗржХрзЛржирзЛ ржзрж░ржирзЗрж░ ржХржирзНржЯрзНрж░рж┐ржмрж┐ржЙрж╢ржи рж╕рзНржмрж╛ржЧржд!

1. ржлрзЛрж░рзНржХ ржХрж░рзБржи
2. ржирждрзБржи ржмрзНрж░рж╛ржЮрзНржЪ рждрзИрж░рж┐ ржХрж░рзБржи (`git checkout -b feature/new-feature`)
3. ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи ржУ ржХржорж┐ржЯ ржХрж░рзБржи (`git commit -m 'Add new feature'`)
4. ржкрзБрж╢ ржХрж░рзБржи (`git push origin feature/new-feature`)
5. ржкрзБрж▓ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржУржкрзЗржи ржХрж░рзБржи

---

## ЁЯСитАНЁЯТ╗ ржЕржерж░

**Sumon Paul**
- **ржкрзЗрж╢рж╛**: DevOps & Cloud Engineer  
- **ржЕржнрж┐ржЬрзНржЮрждрж╛**: 8+ ржмржЫрж░ IT Infrastructure, System Administration, Networking  
- **ржмрж┐рж╢рзЗрж╖рждрзНржм**: OpenStack, Ansible, Cloud, Networking, DevOps

---

## ЁЯТм рж╢рзЗрж╖рзЗрж░ ржХржерж╛

> **ржпрзЗ ржХрзЛржирзЛ ржЬржЯрж┐рж▓ ржкрзНрж░рж╕рзНрждрзБрждрж┐ рж╕рж╣ржЬ рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝ ржпржЦржи ржЖржкржирж┐ ржЕржЯрзЛржорзЗрж╢ржирзЗрж░ ржХрзНрж╖ржорждрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржиред**  
> ржПржЗ playbook ржЖржкржирж╛рж░ DevOps ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛржХрзЗ ржЖрж░ржУ ржжрзНрж░рзБржд, ржирж┐рж░рж╛ржкржж ржУ рж╕рзНржХрзЗрж▓ржпрзЛржЧрзНржп ржХрж░рзЗ рждрзБрж▓рзБржХред  
> рж╕рзБржЦрзА ржбрж┐ржкрзНрж▓ржпрж╝ржорзЗржирзНржЯрзЗрж░ ржЬржирзНржп рж╢рзБржнрзЗржЪрзНржЫрж╛! ЁЯЪА

--- 

тЬЕ **рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ: 2025**  
ЁЯФТ **рж╕рж┐ржХрж┐ржЙрж░, ржЕржЯрзЛржорзЗржЯрзЗржб, ржПржмржВ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-рж░рзЗржбрж┐ред**