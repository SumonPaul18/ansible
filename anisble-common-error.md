```
root@UbuntuDesktop1:~/ansible-prep# ansible-playbook -i inventory.ini site.yml PLAY [Prepare target nodes for Ansible management] ************************************************************* TASK [Gathering Facts] ***************************************************************************************** fatal: [192.168.0.52]: FAILED! => {"msg": "Missing sudo password"} PLAY RECAP ***************************************************************************************************** 192.168.0.52 : ok=0 changed=0 unreachable=0 failed=1 skipped=0 rescued=0 ignored=0 root@UbuntuDesktop1:~/ansible-prep#

```

ржЖржкржирж╛рж░ ржПржЦржиржХрж╛рж░ ржПрж░рж░ржЯрж┐:

1

fatal: [192.168.0.52]: FAILED! => {"msg": "Missing sudo password"}

### ЁЯФН **рж╕ржорж╕рзНржпрж╛рж░ ржХрж╛рж░ржг**

ржЖржкржирж╛рж░ playbook-ржП `become: yes` (ржЕрж░рзНржерж╛рзО `sudo`) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ, ржХрж┐ржирзНрждрзБ:

- ржЖржкржирж╛рж░ **target ржирзЛржбрзЗрж░ `cloud3` ржЗржЙржЬрж╛рж░рзЗрж░ `sudo` ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирзЗржЗ**, **ржЕржержмрж╛**
- `sudo` ржХрж░рждрзЗ **ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж▓рж╛ржЧрзЗ**, ржХрж┐ржирзНрждрзБ Ansible-ржХрзЗ рж╕рзЗржЯрж┐ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝ржирж┐ред

> ЁЯУМ ржоржирзЗ рж░рж╛ржЦрзБржи: ржЖржкржирж╛рж░ playbook **ржкрзНрж░ржержорзЗржЗ `sudo` ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЪрж╛ржпрж╝**, ржХрж┐ржирзНрждрзБ ржПржЦржирзЛ **`cloud3` ржЗржЙржЬрж╛рж░ржХрзЗ `NOPASSWD` sudo ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝ржирж┐** тАФ ржХрж╛рж░ржг рж╕рзЗржЯрж┐ рждрзЛ ржПржЗ playbook-ржЗ ржХрж░ржмрзЗ!

ржЕрж░рзНржерж╛рзО: **ржЖржкржирж┐ ржПржЦржи ржПржХржЯрж┐ "chicken-and-egg" рж╕ржорж╕рзНржпрж╛ржпрж╝ ржЖржЫрзЗржи**ред

---

## тЬЕ **рж╕ржорж╛ржзрж╛ржи: ржкрзНрж░ржержоржмрж╛рж░рзЗрж░ ржЬржирзНржп `--ask-become-pass` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи**

ржпрзЗрж╣рзЗрждрзБ ржЖржкржирж╛рж░ `cloud3` ржЗржЙржЬрж╛рж░рзЗрж░ `sudo` ржХрж░рждрзЗ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж▓рж╛ржЧрзЗ (ржПржмржВ ржПржЦржирзЛ `NOPASSWD` рж╕рзЗржЯ рж╣ржпрж╝ржирж┐), рждрж╛ржЗ ржЖржкржирж╛ржХрзЗ Ansible-ржХрзЗ **sudo ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐рждрзЗ рж╣ржмрзЗ**ред

### ЁЯФз ржзрж╛ржкржЧрзБрж▓рзЛ:

#### 1. **ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржпрзЗ `cloud3` ржЗржЙржЬрж╛рж░рзЗрж░ `sudo` ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЖржЫрзЗ**

SSH ржХрж░рзЗ ржЪрзЗржХ ржХрж░рзБржи:

bash

1

ssh cloud3@192.168.0.52

рждрж╛рж░ржкрж░:

bash

1

sudo whoami

> ржпржжрж┐ ржПржЯрж┐ ржХрж╛ржЬ ржХрж░рзЗ (ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐ржпрж╝рзЗ), рждрж╛рж╣рж▓рзЗ ржЖржкржирж╛рж░ ржЗржЙржЬрж╛рж░рзЗрж░ `sudo` ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЖржЫрзЗ тАФ рж╢рзБржзрзБ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж▓рж╛ржЧрзЗред

> тЭМ ржпржжрж┐ `cloud3 is not in the sudoers file` ржПрж░рж░ ржЖрж╕рзЗ, рждрж╛рж╣рж▓рзЗ ржЖржкржирж╛ржХрзЗ **ржкрзНрж░ржержорзЗ target ржорзЗрж╢рж┐ржирзЗ root рж╣рж┐рж╕рзЗржмрзЗ рж▓ржЧржЗржи ржХрж░рзЗ `cloud3`-ржХрзЗ sudo ржЧрзНрж░рзБржкрзЗ ржпрзЛржЧ ржХрж░рждрзЗ рж╣ржмрзЗ** (ржирж┐ржЪрзЗ ржжрзЗржЦрж╛ржирзЛ рж╣ржпрж╝рзЗржЫрзЗ)ред

---

#### 2. **Playbook рж░рж╛ржи ржХрж░рзБржи `--ask-become-pass` ржЕржкрж╢ржи рж╕рж╣**

bash

1

ansible-playbook -i inventory.ini site.yml --ask-become-pass

> ржПржЯрж┐ ржЖржкржирж╛ржХрзЗ **sudo ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб** ржЪрж╛ржЗржмрзЗ (ржпрж╛ ржЖржкржирж╛рж░ `cloud3` ржЗржЙржЬрж╛рж░рзЗрж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржирж┐ржЬрзЗржЗ)ред

тЬЕ ржПржХржмрж╛рж░ ржПржЗ ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛ржирзЛрж░ ржкрж░, playbook:

- `cloud3`-ржХрзЗ `NOPASSWD` sudo ржжрзЗржмрзЗ
- SSH key рж╕рзЗржЯ ржХрж░ржмрзЗ
- Password-based SSH ржмржирзНржз ржХрж░ржмрзЗ

рждрж╛рж░ржкрж░ ржерзЗржХрзЗ ржЖржкржирж┐ **ржХрзЛржирзЛ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржЫрж╛ржбрж╝рж╛ржЗ** playbook рж░рж╛ржи ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи!

---

## тЭЧ ржпржжрж┐ `cloud3` ржЗржЙржЬрж╛рж░рзЗрж░ `sudo` ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирж╛ ржерж╛ржХрзЗ?

рждрж╛рж╣рж▓рзЗ ржЖржкржирж╛ржХрзЗ **target ржорзЗрж╢рж┐ржирзЗ root рж╣рж┐рж╕рзЗржмрзЗ рж▓ржЧржЗржи ржХрж░рзЗ** ржирж┐ржЪрзЗрж░ ржХрж╛ржЬржЧрзБрж▓рзЛ ржХрж░рждрзЗ рж╣ржмрзЗ:

### ржзрж╛ржк 1: root рж╣рж┐рж╕рзЗржмрзЗ SSH ржХрж░рзБржи

bash

1

ssh root@192.168.0.52

### ржзрж╛ржк 2: `cloud3` ржЗржЙржЬрж╛рж░ржХрзЗ `sudo` ржЧрзНрж░рзБржкрзЗ ржпрзЛржЧ ржХрж░рзБржи

- **Ubuntu/Debian**:
    
    bash
    
    1
    
    usermod -aG sudo cloud3
    
- **CentOS/Rocky/AlmaLinux**:
    
    bash
    
    1
    
    usermod -aG wheel cloud3
    

### ржзрж╛ржк 3: `cloud3` ржПрж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж╕рзЗржЯ ржХрж░рзБржи (ржпржжрж┐ ржирж╛ ржерж╛ржХрзЗ)

bash

1

passwd cloud3

### ржзрж╛ржк 4: рж▓ржЧржЖржЙржЯ ржХрж░рзБржи

bash

1

exit

ржПржЦржи ржЖржмрж╛рж░ `--ask-become-pass` ржжрж┐ржпрж╝рзЗ playbook рж░рж╛ржи ржХрж░рзБржиред

---

## ЁЯУМ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк

|рж╕ржорж╕рзНржпрж╛|рж╕ржорж╛ржзрж╛ржи|
|---|---|
|`Missing sudo password`|`ansible-playbook ... --ask-become-pass`|
|`cloud3`-ржПрж░`sudo`ржирзЗржЗ|root рж╣рж┐рж╕рзЗржмрзЗ рж▓ржЧржЗржи тЖТ`usermod -aG sudo cloud3`|
|ржкрж░ржмрж░рзНрждрзА рж░рж╛ржирзЗ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж▓рж╛ржЧржмрзЗ ржирж╛|ржХрж╛рж░ржг playbook ржирж┐ржЬрзЗржЗ`NOPASSWD`sudo рж╕рзЗржЯ ржХрж░ржмрзЗ|

---

## тЦ╢я╕П ржПржЦржи ржХрзА ржХрж░ржмрзЗржи?

1. ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи `cloud3` ржПрж░ `sudo` ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЖржЫрзЗ (SSH ржХрж░рзЗ `sudo whoami` ржЪрж╛рж▓рж╛ржи)
2. рждрж╛рж░ржкрж░ ржПржЗ ржХржорж╛ржирзНржб рж░рж╛ржи ржХрж░рзБржи:
    
    bash
    
    1
    
    ansible-playbook -i inventory.ini site.yml --ask-become-pass
    
3. ржкрзНрж░ржержорзЗ **SSH ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб** (ржпржжрж┐ `sshpass` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржи), рждрж╛рж░ржкрж░ **sudo ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб** ржЪрж╛ржЗржмрзЗ тАФ ржжрзБржЯрзЛржЗ ржЖржкржирж╛рж░ `cloud3` ржЗржЙржЬрж╛рж░рзЗрж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржбред

тЬЕ ржПржХржмрж╛рж░ рж╕ржлрж▓ рж╣рж▓рзЗ, ржкрж░ржмрж░рзНрждрзА рж╕ржмржХрж┐ржЫрзБ ржЕржЯрзЛржорзЗржЯрж┐ржХ рж╣ржмрзЗ!

---

ржпржжрж┐ ржЖржмрж╛рж░ржУ ржХрзЛржирзЛ ржПрж░рж░ ржЖрж╕рзЗ (ржпрзЗржоржи: `Authentication failure`), рждржЦржи ржЬрж╛ржирж╛ржи тАФ ржЖржорж┐ ржЖржкржирж╛ржХрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░ржмред ЁЯЫая╕П